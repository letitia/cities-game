// Generated by CoffeeScript 1.3.3
(function() {
  var __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  window.curr_letter = '';

  window.last_city = '';

  window.used_cities = [];

  window.handleSubmit = function() {
    var valid;
    valid = validate();
    update();
    if (valid) {
      return setTimeout(computerTurn, 1000);
    }
  };

  window.validate = function() {
    var city_list_starting_with, city_name, country_id, first_letter, input, input_city, tuple, _i, _len;
    input = $('input[name=city_name]');
    input_city = $.trim(input.val());
    first_letter = input_city[0].toUpperCase();
    input_city = first_letter + input_city.substr(1);
    if (!cities.hasOwnProperty(first_letter)) {
      $('.status').text("Invalid First letter!");
      return false;
    }
    if (__indexOf.call(used_cities, input_city) >= 0) {
      $('.status').text("You've used that city already!  Try again.");
      return false;
    }
    city_list_starting_with = cities[first_letter];
    for (_i = 0, _len = city_list_starting_with.length; _i < _len; _i++) {
      tuple = city_list_starting_with[_i];
      city_name = tuple[0];
      country_id = tuple[1];
      if (city_name === input_city) {
        $('.status').text("You got it!  " + city_name + " is in " + countries[country_id]);
        window.last_city = city_name;
        used_cities.push(city_name);
        input.val('');
        return true;
      }
    }
    $('.status').text(input_city + " is NOT a valid city.");
    return false;
  };

  window.update = function() {
    $('.streak').text(used_cities);
    return $('.count').text(used_cities.length);
  };

  window.computerTurn = function() {
    return $('.status').text("Computer's turn...");
  };

  window.handleInputKeyup = function(e) {
    if (e.keyCode === 13) {
      return handleSubmit();
    }
  };

}).call(this);
