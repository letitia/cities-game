// Generated by CoffeeScript 1.3.3
var __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

window.curr_letter = '';

window.last_city = '';

window.used_cities = [];

window.handleInputKeyup = function(evt) {
  if (evt.keyCode === 13) {
    return handleSubmit();
  }
};

window.handleSubmit = function() {
  var cityname, isValid, status;
  cityname = $.trim($('input[name=city_name]').val());
  try {
    isValid = isValidCity(cityname);
    return handleComputerTurn();
  } catch (error) {
    status = $('.status');
    switch (error) {
      case "FirstLetter":
        return status.text("The first letter you typed is not in the English alphabet.");
      case "DuplicateCity":
        return status.text("You've used that city already!");
      case "InvalidCity":
        return status.text(cityname + " is not a valid city.");
    }
  } finally {
    updateDisplay();
  }
};

window.isValidCity = function(input_city) {
  var city, city_list_starting_with, country_id, first_letter, list_city, tuple, _i, _len;
  first_letter = input_city[0].toUpperCase();
  city = first_letter + input_city.substr(1);
  if (!cities.hasOwnProperty(first_letter)) {
    throw "FirstLetter";
  }
  if (__indexOf.call(used_cities, city) >= 0) {
    throw "DuplicateCity";
  }
  city_list_starting_with = cities[first_letter];
  for (_i = 0, _len = city_list_starting_with.length; _i < _len; _i++) {
    tuple = city_list_starting_with[_i];
    list_city = tuple[0];
    country_id = tuple[1];
    if (city === list_city) {
      $('.status').text("You got it!  " + list_city + " is in " + countries[country_id]);
      window.last_city = list_city;
      used_cities.push(list_city);
      $('input[name=city_name]').val('');
      return true;
    }
  }
  throw "InvalidCity";
};

window.updateDisplay = function() {
  $('.streak').text(used_cities);
  return $('.count').text(used_cities.length);
};

window.handleComputerTurn = function(valid) {
  if (valid) {
    return setTimeout(computerTurn, 1000);
  }
};

window.computerTurn = function() {
  return $('.status').text("Computer's turn...");
};

window.runTestCases = function() {
  testIsValid('Stanford');
  testIsInvalid('Pirateville');
  testIsValid('dubai');
  return testIsValid('Belem');
};

window.testIsValid = function(cityname) {
  var $result, passed;
  passed = isValidCity(cityname);
  $result = $('<div />').text("Testing that " + cityname + " is valid ... " + resultText(passed));
  $result.css('color', resultColor(passed));
  return $('.testresults').append($result);
};

window.testIsInvalid = function(cityname) {
  var $result, passed;
  passed = !isValidCity(cityname);
  $result = $('<div />').text("Testing that " + cityname + " is not valid ... " + resultText(passed));
  $result.css('color', resultColor(passed));
  return $('.testresults').append($result);
};

window.resultText = function(passed) {
  if (passed) {
    return 'Passed';
  } else {
    return 'Failed';
  }
};

window.resultColor = function(passed) {
  if (passed) {
    return 'green';
  } else {
    return 'red';
  }
};
